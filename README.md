# XTB US Stocks - Daily Report

## Libraries
* <code>pandas</code>
* <code>pandas-datareader</code>
* <code>openpyxl</code>
* <code>dropbox</code>


## 1. The Idea
I've recently migrated all my stock market activities to [xtb.com](https://www.xtb.com/pl) platform. My portfolio is divided into two distinct strategies: 
* Value Investing
* Short-term Investing 

This project has been created to give me more insights for the Short-term Investing. The goal was to <b> set up a customized automated daily excel report </b> which shows price fluctuations for all the US stock market assets available in XTB.  

## 2. How It Was Done

There were 3 key steps I had to tackle in order to make this project work: 

1. Getting US stocks tickers from XTB
2. Creating Python script to get data for the tickers collected and create the report
3. Automate the whole process - to exclude any kind of manual-touchpoints

### 2.1. How I gathered tickers from XTB

[XTB - available stocks](https://www.xtb.com/pl/oferta/informacje-o-rachunku/specyfikacja-instrumentow#cashstocks) - here is the page listing all the stocks available in 
XTB platform grouped by countries. The website is packed with Java Script which makes it really hard for standard scraping strategies 
with <code>requests</code> or even <code>selenium</code>. After a few unsuccessful attempts with the latter, 
I knew I had to change my strategy. To overpass the difficulties mentioned, I utilized Chrome Developer Tools:
<code>CTRL+SHIFT+I</code> -> Then, within Network tab you can find all the requests which are generated by the page when it's refreshed. 
One of those generated in XTB page was [following](https://www.xtb.com/api/pl/instruments/get?queryString=&instrumentTypeSlug=cashstocks&page=2&country=US&_=1631179751777). 
It's just a JSON file with the subset of data I needed. Now it was only the matter of solving the logic (not really sophisticated, +1 for each page) between the numbers changing in URL - to get all the data possible. 

The code for this you can find in <code> get_xtb_tickers.ipynb </code>

### 2.2. Getting Prices Data
With the tickers ready, I was able to set up a script to collect daily xtb data - <code>get-xtb-data.py</code>. The way it works is following: 

1. Using <code>pandas-datareader</code> and yahoo finance as source get last 90 days prices for each ticker. 
2. Calculate useful measures:
    - Price changes: most recent price vs 7days ago, 21days ago, 30days ago, 90days ago. 
    - Price dynamics: Are there any stocks experiencing constant price drop in 7days, 14days?
3. With the dataframe with all the stocks, prices and measures calculated - save it to excel file. 
4. Next, the excel file is customized (for a nicer layout) with <code>openpyxl</code> 
5. Finally, the customized excel file is uploaded to Dropbox with <code>Dropbox API</code>

### 2.3. Automation
The script is now run on a daily basis from my <b> Raspberry Pi </b> - so everyday I'm provided with a new version of the report delivered directly into my Dropbox. 





